# 孫っち - 技術スタック

> 最終更新: 2024年12月

## 技術選定方針

1. **モダンで学習価値の高い技術**を優先
2. **開発速度**を重視（個人開発のため）
3. **コスト効率**を考慮

---

## フロントエンド

| 項目 | 選定 | 理由 |
|------|------|------|
| フレームワーク | **Vue 3** | Composition API、TypeScript対応、学習曲線が緩やか |
| 言語 | **TypeScript** | 型安全性、開発体験向上 |
| ビルドツール | **Vite** | 高速な開発サーバー、Vue公式推奨 |
| CSSフレームワーク | **TailwindCSS** | ユーティリティファースト、カスタマイズ容易 |
| 状態管理 | **Pinia** | Vue 3公式推奨、シンプル |
| PWA | **vite-plugin-pwa** | オフライン対応、プッシュ通知 |

### 音声関連
| 項目 | 選定 | 理由 |
|------|------|------|
| 音声入力 | **Web Audio API** + **MediaRecorder** | ブラウザ標準、追加ライブラリ不要 |
| 音声出力 | **Audio API** | TTS音声ファイルの再生 |

---

## バックエンド

| 項目 | 選定 | 理由 |
|------|------|------|
| ランタイム | **Node.js** | JavaScript/TypeScript統一、エコシステム充実 |
| フレームワーク | **Fastify** | 高速、TypeScript対応良好、プラグイン豊富 |
| 言語 | **TypeScript** | フロントと統一、型安全性 |
| バリデーション | **Zod** | TypeScript-first、スキーマ共有可能 |

### 代替案
- Express: 情報量は多いがFastifyの方がモダン
- Hono: 軽量で良いが、PoC後に再検討

---

## AI / 音声処理

| 項目 | 選定 | 理由 |
|------|------|------|
| LLM | **Claude API** (Anthropic) | 日本語品質、安全性、長文コンテキスト |
| 音声認識 (STT) | **Whisper API** (OpenAI) | 高精度、多言語対応、コスト効率 |
| 音声合成 (TTS) | **ElevenLabs** or **VOICEVOX** | 自然な日本語音声 |
| 埋め込み | **OpenAI Embeddings** | RAG用、text-embedding-3-small |

### TTS比較
| サービス | 特徴 | 課題 |
|---------|------|------|
| ElevenLabs | 高品質、多言語 | コスト高め |
| VOICEVOX | 無料、日本語特化 | セルフホスト必要 |
| Google Cloud TTS | 安定、日本語対応 | 品質はElevenLabsに劣る |

→ PoC段階で比較検証

---

## データベース

| 項目 | 選定 | 理由 |
|------|------|------|
| RDB | **PostgreSQL** | 信頼性、Supabaseで無料利用可能 |
| Vector DB | **Supabase pgvector** | PostgreSQLと統合、追加サービス不要 |
| ORM | **Drizzle ORM** | TypeScript-first、軽量 |

### 代替案
- Pinecone: Vector DB専用だがコスト発生
- Prisma: 情報量多いがDrizzleの方が軽量

---

## インフラ / デプロイ

| 項目 | 選定 | 理由 |
|------|------|------|
| DB/Auth | **Supabase** | PostgreSQL + Vector + Auth、無料枠あり |
| フロントエンド | **Vercel** | Vite対応、無料枠、自動デプロイ |
| バックエンド | **Railway** or **Render** | Node.js対応、無料枠 |
| ドメイン | 後で検討 | MVP後に取得 |

---

## 開発ツール

| 項目 | 選定 |
|------|------|
| パッケージマネージャ | **pnpm** |
| リンター | **ESLint** + **Prettier** |
| テスト | **Vitest** |
| Git hooks | **Husky** + **lint-staged** |
| API開発 | **Thunder Client** or **Bruno** |

---

## アーキテクチャ概要

```
┌─────────────────────────────────────────────────────────┐
│                      Frontend (Vue 3)                    │
│                     Vercel / Netlify                     │
└─────────────────────────┬───────────────────────────────┘
                          │ HTTPS
                          ▼
┌─────────────────────────────────────────────────────────┐
│                   Backend (Fastify)                      │
│                   Railway / Render                       │
├─────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────┐ │
│  │ Voice API   │  │ Chat API    │  │ Task API        │ │
│  │ (STT/TTS)   │  │ (LLM)       │  │ (CRUD)          │ │
│  └─────────────┘  └─────────────┘  └─────────────────┘ │
└─────────────────────────┬───────────────────────────────┘
                          │
         ┌────────────────┼────────────────┐
         ▼                ▼                ▼
┌─────────────┐  ┌─────────────┐  ┌─────────────────┐
│ Whisper API │  │ Claude API  │  │ Supabase        │
│ (OpenAI)    │  │ (Anthropic) │  │ PostgreSQL +    │
│             │  │             │  │ pgvector        │
└─────────────┘  └─────────────┘  └─────────────────┘
```

---

## コスト見積もり（月額・MVP段階）

| サービス | 無料枠 | 想定使用量 | 費用 |
|---------|--------|-----------|------|
| Vercel | あり | 十分 | $0 |
| Railway | 月$5相当 | 十分 | $0-5 |
| Supabase | 月500MB | 十分 | $0 |
| Claude API | - | 100会話/日想定 | ~$20-50 |
| Whisper API | - | 100会話/日想定 | ~$5-10 |
| ElevenLabs | 月10,000文字 | 超過の可能性 | $0-11 |

**想定月額: $25-75程度**（開発・テスト段階）

---

*関連ドキュメント: [MVP仕様](./03_MVP_SPEC.md) | [リスク](./05_RISKS.md)*
